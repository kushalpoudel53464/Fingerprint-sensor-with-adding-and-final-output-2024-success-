#include <Adafruit_Fingerprint.h>
#include <Servo.h>

SoftwareSerial mySerial(2, 3);
Adafruit_Fingerprint finger = Adafruit_Fingerprint(&mySerial);
Servo myServo;

#define SERVO_PIN       9 // Choose the pin connected to the servo
#define ACCESS_DELAY    3000 // Keep lock unlocked for 3 seconds 

void setup()
{
  finger.begin(57600);
  delay(5);
  if (finger.verifyPassword()) 
  {
  } 
  else 
  {
    while (1) { delay(1); }
  }
  
  myServo.attach(SERVO_PIN);
  myServo.write(90); // Move the servo to the initial position (90 degrees)
}

void loop()
{
  if ( getFingerPrint() != -1)
  {
    unlockDoor();
    delay(ACCESS_DELAY);
    lockDoor();
  }  
  delay(50); // Add some delay before next scan.
}

int getFingerPrint() 
{
  int p = finger.getImage();
  if (p != FINGERPRINT_OK)  return -1;

  p = finger.image2Tz();
  if (p != FINGERPRINT_OK)  return -1;

  p = finger.fingerFastSearch();
  if (p != FINGERPRINT_OK)  return -1;

  // found a match!
  return finger.fingerID;
}

void unlockDoor()
{
  myServo.write(0); // Move the servo to 0 degrees (unlock position)
}

void lockDoor()
{
  myServo.write(90); // Move the servo back to 90 degrees (lock position)
}
